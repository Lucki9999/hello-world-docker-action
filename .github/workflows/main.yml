#on: [push]
#
#jobs:
#  hello_world_job:
#    runs-on: ubuntu-latest
#    name: A job to say hello
#    steps:
#      - name: Hello world action step
#        id: hello
#        uses: docker/build-push-action@v2
#        with:
#          tags: localbuild/testimage:latest
#          push: false
#          load: true
#          who-to-greet: 'Mona the Octocat'
#      # Use the output from the `hello` step
#      - name: Get the output time
#        run: echo "The time was ${{ steps.hello.outputs.time }}"
#      - name: Scan image
#        uses: anchore/scan-action@v2
#        with:
#          image: "localbuild/testimage:latest"
#          fail-build: true
#          severity-cutoff: critical
name: Container Image CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build the container image
        run: docker build . --file Dockerfile --tag localbuild/testimage:latest
      - uses: anchore/scan-action@v2
        with:
          image: "localbuild/testimage:latest"
          fail-build: true
      - name: grype scan JSON results
        run: for j in `ls ./anchore-reports/*.json`; do echo "---- ${j} ----"; cat ${j}; echo; done


